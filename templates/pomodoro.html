<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff; /* Light blue background */
        }
        .content {
            margin-left: 22%; /* Adjusted for sidebar */
            padding: 20px;
        }
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 20%;
            background-color: #333; /* Dark sidebar */
            position: fixed;
            height: 100%;
            overflow: auto;
        }
        li a {
            display: block;
            color: white;
            padding: 10px 16px;
            text-decoration: none;
            font-size: 40px;
        }
        li a.active {
            background-color: #04AA6D;
            color: white;
        }
        li a:hover:not(.active) {
            background-color: #575757;
            color: white;
        }
    </style>
</head>
<body>

    <ul>
        <li><a class="index" href="/">Koduleht</a></li>
        <li><a href="pomodoro" class="active">Taimer</a></li>
        <li><a href="todolist">To-do list</a></li>
        <li><a href="settings">Settings</a></li>
    </ul>
    <div class="content">
        
        <h1>Pomodoro Timer</h1>
        <p>Aega j채채nud:</p>
        <div id="timer">0:00</div>
        <form onsubmit="updateTimer(event)">
            <input type="number" id="tunnid" placeholder="Tunnid">
            <input type="number" id="minutid" placeholder="Minutid">
            <input type="number" id="sekundid" placeholder="Sekundid">
            <button id="start-btn" type="submit">K채ivita taimer!</button>
        </form>


    </div>
    
    <!-- Audio element for the alarm sound -->
    <audio id="alarm-sound" src="/static/alarm.mp3"></audio>

    <script>
        let timerInterval;
        let timerWindow;
        const alarmSound = document.getElementById("alarm-sound");

        function isAudioEnabled() {
            const value = localStorage.getItem("audioEnabled");
            return value === null ? true : value === "true";
        }

        function updateTimer(event) {
            event.preventDefault(); // Prevent form submission
    
            // Clear any existing timer
            clearInterval(timerInterval);
    
            // Get the duration from the input field
            const tunnid = document.getElementById("tunnid");
            const minutid = document.getElementById("minutid");
            const sekundid = document.getElementById("sekundid");
            let timeLeft = parseInt(tunnid.value*3600) + parseInt(minutid.value*60) + parseInt(sekundid.value);
    
            // Update the timer display
            const timerDisplay = document.getElementById("timer");
            timerDisplay.textContent = formatTime(timeLeft);
    
            if (!timerWindow || timerWindow.closed) {
            timerWindow = window.open("", "TimerWindow", "width=300,height=200");
        }
        timerWindow.document.body.innerHTML = `<h1>Remaining Time</h1><div id="external-timer">${formatTime(timeLeft)}</div>`;
            // Start the countdown
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);

                if (timerWindow && !timerWindow.closed) {
                const externalTimer = timerWindow.document.getElementById("external-timer");
                if (externalTimer) {
                    externalTimer.textContent = formatTime(timeLeft);
                }
            }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
<<<<<<< Updated upstream
                    alarmSound.play().catch(error => {
                    console.error("Failed to play alarm sound:", error);
                });
                if (timerWindow && !timerWindow.closed) {
                    timerWindow.close();
                }
                
=======
                    if (isAudioEnabled()) {
                        alarmSound.play().catch(error => {
                            console.error("Failed to play alarm sound:", error);
                        });
                    }
>>>>>>> Stashed changes
                    alert("Aeg on l채bi!"); // Notify the user when the timer ends

                }
            }, 1000);
        }
    
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds < 10 ? "0" : ""}${remainingSeconds}`;
        }
    </script>
</body>
</html>
``` 
