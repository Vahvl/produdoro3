<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff; /* Light blue background */
        }
        .content {
            margin-left: 22%; /* Adjusted for sidebar */
            padding: 20px;
        }
        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 20%;
            background-color: #333; /* Dark sidebar */
            position: fixed;
            height: 100%;
            overflow: auto;
        }
        li a {
            display: block;
            color: white;
            padding: 10px 16px;
            text-decoration: none;
            font-size: 40px;
        }
        li a.active {
            background-color: #04AA6D;
            color: white;
        }
        li a:hover:not(.active) {
            background-color: #575757;
            color: white;
        }
    </style>
</head>
<body>

    <ul>
        <li><a class="index" href="/">Koduleht</a></li>
        <li><a href="pomodoro" class="active">Taimer</a></li>
        <li><a href="todolist">To-do list</a></li>
        <li><a href="settings">Settings</a></li>
    </ul>
    <div class="content">
        
        <h1>Pomodoro Timer</h1>
        <p>Aega j채채nud:</p>
        <div id="timer">0:00</div>
        <form onsubmit="updateTimer(event)">
            <input type="number" id="tunnid" placeholder="Tunnid">
            <input type="number" id="minutid" placeholder="Minutid">
            <input type="number" id="sekundid" placeholder="Sekundid">
            <button id="start-btn" type="submit">K채ivita taimer!</button>
        </form>


    </div>
    
    <!-- Audio element for the alarm sound -->
    <audio id="alarm-sound" src="/static/alarm.mp3"></audio>

    <script>
        let timerInterval;
        let timerWindow = null;
        const alarmSound = document.getElementById("alarm-sound");

        function isAudioEnabled() {
            const value = localStorage.getItem("audioEnabled");
            return value === null ? true : value === "true";
        }

        function hexToRgb(hex) {
            hex = hex.replace('#', '');
            if (hex.length === 3) {
                hex = hex.split('').map(x => x + x).join('');
            }
            const num = parseInt(hex, 16);
            return [num >> 16, (num >> 8) & 255, num & 255];
        }
        function rgbToHex([r, g, b]) {
            return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
        }
        function adjustColor(hex, percent) {
            let [r, g, b] = hexToRgb(hex);
            r = Math.min(255, Math.max(0, Math.round(r + (percent/100)*255)));
            g = Math.min(255, Math.max(0, Math.round(g + (percent/100)*255)));
            b = Math.min(255, Math.max(0, Math.round(b + (percent/100)*255)));
            return rgbToHex([r, g, b]);
        }
        function applyColors() {
            const bg = localStorage.getItem("bgColor") || "#f0f8ff";
            const sidebar = localStorage.getItem("sidebarColor") || "#333333";
            document.body.style.backgroundColor = bg;
            const sidebarEl = document.querySelector("ul");
            if (sidebarEl) sidebarEl.style.backgroundColor = sidebar;
            const activeColor = adjustColor(sidebar, 30);
            const hoverColor = adjustColor(sidebar, 15);
            let styleTag = document.getElementById("sidebar-dynamic-style");
            if (!styleTag) {
                styleTag = document.createElement("style");
                styleTag.id = "sidebar-dynamic-style";
                document.head.appendChild(styleTag);
            }
            styleTag.textContent = `
                ul li a.active {
                    background-color: ${activeColor} !important;
                    color: white !important;
                }
                ul li a:hover:not(.active) {
                    background-color: ${hoverColor} !important;
                    color: white !important;
                }
            `;
        }
        document.addEventListener("DOMContentLoaded", applyColors);

        function updateTimer(event) {
            event.preventDefault(); // Prevent form submission
    
            // Clear any existing timer
            clearInterval(timerInterval);
    
            // Get the duration from the input fields
            const tunnid = parseInt(document.getElementById("tunnid").value) || 0;
            const minutid = parseInt(document.getElementById("minutid").value) || 0;
            const sekundid = parseInt(document.getElementById("sekundid").value) || 0;
            let timeLeft = tunnid * 3600 + minutid * 60 + sekundid;
    
            // Update the timer display
            const timerDisplay = document.getElementById("timer");
            timerDisplay.textContent = formatTime(timeLeft);
    
            // Open or reuse the timer window
            if (!timerWindow || timerWindow.closed) {
                timerWindow = window.open("", "TimerWindow", "width=300,height=200");
            }
            timerWindow.document.body.innerHTML = `<h1>Remaining Time</h1><div id="external-timer">${formatTime(timeLeft)}</div>`;
    
            // Start the countdown
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);

                // Update timer in the popup window
                if (timerWindow && !timerWindow.closed) {
                    const externalTimer = timerWindow.document.getElementById("external-timer");
                    if (externalTimer) {
                        externalTimer.textContent = formatTime(timeLeft);
                    }
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if (timerWindow && !timerWindow.closed) {
                        timerWindow.close();
                    }
                    if (isAudioEnabled()) {
                        alarmSound.play().catch(error => {
                            console.error("Failed to play alarm sound:", error);
                        });
                    }
                    alert("Aeg on l채bi!"); // Notify the user when the timer ends
                }
            }, 1000);
        }
    
        function formatTime(seconds) {
            if (seconds < 0) seconds = 0;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds < 10 ? "0" : ""}${remainingSeconds}`;
        }
    </script>
</body>
</html>
``` 
